# OCI GPU Training Cluster Architecture
# Compile: d2 --layout=tala oci-gpu-cluster.d2 oci-gpu-cluster.svg

direction: down

title: OCI GPU Training Cluster {
  near: top-center
  style.font-size: 28
  style.bold: true
}

# ==== DATA INGESTION ====
ingestion: Data Ingestion {
  style.fill: "#E3F2FD"
  style.stroke: "#1976D2"

  sources: Data Sources {
    db: Databases
    files: File Systems
    streams: Data Streams
  }

  dataflow: OCI Data Flow {
    shape: parallelogram
    style.fill: "#2196F3"
    style.font-color: "#FFF"
  }
}

# ==== STORAGE LAYER ====
storage: Storage Layer {
  style.fill: "#FFF3E0"
  style.stroke: "#F57C00"

  objstore: Object Storage {
    shape: cylinder
    style.fill: "#FF9800"
    style.font-color: "#FFF"

    raw: Raw Data
    processed: Processed
    checkpoints: Checkpoints
  }

  fss: File Storage {
    shape: cylinder
    style.fill: "#FFB74D"

    shared: Shared Models
    datasets: Datasets
  }
}

# ==== GPU CLUSTER ====
cluster: GPU Supercluster {
  style.fill: "#E8F5E9"
  style.stroke: "#388E3C"
  style.stroke-width: 3

  # RDMA Network
  rdma: RDMA Cluster Network {
    style.fill: "#81C784"
    style.stroke-width: 2

    spine: Spine Switches {
      shape: hexagon
      style.fill: "#4CAF50"
      style.font-color: "#FFF"
    }
  }

  # GPU Nodes
  nodes: GPU Nodes {
    style.fill: "#A5D6A7"

    node1: BM.GPU.H100.8 {
      style.fill: "#66BB6A"
      style.font-color: "#FFF"

      g1: GPU 0
      g2: GPU 1
      g3: GPU 2
      g4: GPU 3
      g5: GPU 4
      g6: GPU 5
      g7: GPU 6
      g8: GPU 7
    }

    node2: BM.GPU.H100.8 {
      style.fill: "#66BB6A"
      style.font-color: "#FFF"

      g1: GPU 0
      g2: GPU 1
      g3: GPU ...
      g8: GPU 7
    }

    nodeN: BM.GPU.H100.8 x N {
      style.fill: "#66BB6A"
      style.font-color: "#FFF"

      gpus: 8 GPUs each
    }
  }

  # Specs
  specs: Cluster Specs {
    style.fill: "#C8E6C9"

    latency: "RDMA: 2.5Î¼s latency"
    bandwidth: "100 Gbps per connection"
    scale: "Up to 131K GPUs (Supercluster)"
  }
}

# ==== ML PLATFORM ====
platform: ML Platform {
  style.fill: "#F3E5F5"
  style.stroke: "#7B1FA2"

  datascience: OCI Data Science {
    shape: rectangle
    style.fill: "#9C27B0"
    style.font-color: "#FFF"

    notebooks: JupyterLab
    jobs: Training Jobs
    models: Model Catalog
  }

  mlflow: MLflow {
    shape: rectangle
    style.fill: "#AB47BC"
    style.font-color: "#FFF"

    experiments: Experiments
    registry: Model Registry
  }
}

# ==== INFERENCE ====
inference: Inference Layer {
  style.fill: "#FFEBEE"
  style.stroke: "#C62828"

  dac: Dedicated AI Cluster {
    style.fill: "#EF5350"
    style.font-color: "#FFF"
    style.stroke-width: 3
  }

  endpoints: Model Endpoints {
    style.fill: "#E57373"
    style.font-color: "#FFF"

    ep1: Endpoint 1
    ep2: Endpoint 2
    epN: Endpoint N
  }
}

# ==== CONNECTIONS ====
ingestion.sources -> ingestion.dataflow
ingestion.dataflow -> storage.objstore

storage.objstore -> cluster.nodes: Training Data
storage.fss -> cluster.nodes: Shared Access

cluster.nodes.node1 <-> cluster.rdma.spine: NVLink + RDMA {
  style.stroke: "#4CAF50"
  style.stroke-width: 3
}
cluster.nodes.node2 <-> cluster.rdma.spine {
  style.stroke: "#4CAF50"
  style.stroke-width: 3
}
cluster.nodes.nodeN <-> cluster.rdma.spine {
  style.stroke: "#4CAF50"
  style.stroke-width: 3
}

cluster -> platform.datascience: Training Orchestration
platform.datascience -> platform.mlflow: Track Experiments

platform.mlflow -> inference.dac: Deploy Model
inference.dac -> inference.endpoints

cluster -> storage.objstore.checkpoints: Checkpoints {
  style.stroke-dasharray: 5
}

# ==== LEGEND ====
legend: Infrastructure Options {
  style.fill: "#FAFAFA"
  near: bottom-right

  opt1: "BM.GPU.A100-v2.8: 8x A100 (640GB)"
  opt2: "BM.GPU.H100.8: 8x H100 (640GB)"
  opt3: "BM.GPU.B200.8: 8x B200 (1.4TB)"
  opt4: "Supercluster: Up to 131K GPUs"
}
